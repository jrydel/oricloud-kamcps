import{f as N,d as K,_ as H}from"./dateTime-e20df54b.js";import{A as t,i as q,u as U,e as G,a as J,f as F}from"./useDataProvider-03a214e4.js";import{d as O,c as d,o as u,a as c,u as l,t as g,b as v,e as B,q as Q,r as X,g as L,w as Z,F as I,f as E,l as P,a4 as tt,p as et,h as st}from"./index-64045075.js";import{a as at}from"./CompetitionView-e5b3497d.js";const z=s=>nt[s],nt={[t.Ok]:"OK",[t.Mispunch]:"DISK",[t.Disqualified]:"DISK",[t.DidNotFinish]:"DNF",[t.Running]:"...",[t.NotStarted]:"-",[t.OverMaxTime]:"DISK",[t.DidNotStart]:"DNS",[t.NotCompeting]:"MS"},lt={class:"grid gap-2 px-3 py-1.5"},ot={key:0,class:"tabular-nums"},ut={key:1,class:"tabular-nums"},rt={key:2},it={key:3,class:"text-right tabular-nums"},ct={key:4,class:"text-right tabular-nums"},dt={key:5,class:"text-right"},mt={class:"text-right tabular-nums"},gt=O({__name:"CategoryRelayTableRowTeam",props:{data:null},setup(s){const e=s,R=d(()=>e.data.latestTotalResult.status===t.Ok?N(e.data.latestTotalResult.timeSeconds):""),S=d(()=>e.data.latestTotalResult.status===t.Ok?`+ ${N(e.data.latestTotalResult.loss)}`:""),k=T=>T.replace(/\s/g,""),f=d(()=>k(e.data.name));return(T,p)=>(u(),c("div",lt,[s.data.status===l(t).Ok&&s.data.latestTotalResult.status===l(t).Ok?(u(),c("span",ot,g(s.data.latestTotalResult.rank)+".",1)):s.data.latestTotalResult.status===l(t).Ok?(u(),c("span",ut,"["+g(s.data.latestTotalResult.rank)+".]",1)):(u(),c("span",rt)),v("span",null,g(l(f))+" - "+g(s.data.club),1),s.data.status===l(t).Ok?(u(),c("span",it,g(l(R)),1)):s.data.status===l(t).Running&&l(R)?(u(),c("span",ct,"["+g(l(R))+"]",1)):(u(),c("span",dt,g(l(z)(s.data.status)),1)),v("span",mt,g(l(S)),1)]))}}),ft=O({__name:"SlotVirtualizer",props:{isVisible:{type:Boolean}},setup(s){return(e,R)=>s.isVisible?B(e.$slots,"default",{key:0}):B(e.$slots,"placeholder",{key:1})}}),ht={class:"grid gap-2 px-3 py-1.5"},Rt=v("span",null,null,-1),yt={key:0,class:"text-right tabular-nums"},Tt={key:1,class:"text-right tabular-nums"},pt={key:2,class:"text-right tabular-nums"},_t={key:3,class:"text-right"},vt={class:"text-right tabular-nums"},St=O({__name:"CategoryRelayTableRowAthlete",props:{data:null},setup(s){const e=s,R=Q(q,X(!1)),{now:S,timeFormatter:k}=U(),f=d(()=>e.data.legResult.status===t.Ok?N(e.data.legResult.timeSeconds):""),T=d(()=>e.data.totalResult.status===t.Ok?`+ ${N(e.data.totalResult.loss)}`:""),p=d(()=>G(e.data.legResult)?e.data.startTime?e.data.startTime<S.value:e.data.status===t.Running:!1),x=d(()=>{if(!e.data.startTime||!p.value)return"";const _=K(S.value,e.data.startTime);return N(_)}),y=d(()=>e.data.status===t.NotStarted),b=d(()=>!e.data.startTime||!y.value?"":k.format(e.data.startTime));return(_,C)=>(u(),c("div",ht,[Rt,v("span",null,g(s.data.surname)+" "+g(s.data.firstName),1),L(ft,{"is-visible":l(R)},{default:Z(()=>[s.data.legResult.status===l(t).Ok?(u(),c("span",yt,g(l(f))+" ["+g(s.data.legResult.rank)+".]",1)):l(p)?(u(),c("span",Tt,"["+g(l(x))+"]",1)):l(y)?(u(),c("span",pt,g(l(b)),1)):(u(),c("span",_t,g(l(z)(s.data.status)),1))]),_:1},8,["is-visible"]),v("span",vt,g(l(T)),1)]))}}),kt=v("span",null,null,-1),xt=v("span",null,".",-1),bt=[kt,xt],Ct=O({__name:"CategoryRelayTableRow",props:{data:null,isEven:{type:Boolean},legCount:null},setup(s){const e=s,{now5s:R}=U(),S=d(()=>e.legCount+1),k=5*60,f=d(()=>e.data.updatedAt?K(R.value,e.data.updatedAt)<k:!1),T=d(()=>f.value?"bg-highlight":e.isEven?"bg-even":"bg-white"),p=d(()=>f.value?"text-white":"text-black"),x=d(()=>{const y=e.legCount-e.data.athletes.length;return y>0?y:0});return(y,b)=>(u(),c("div",{class:tt([[`grid-rows-${l(S)}`,l(T),l(p)],"grid rounded-lg"])},[L(gt,{class:"table-row-grid text-table-large",data:e.data},null,8,["data"]),(u(!0),c(I,null,E(s.data.athletes,_=>(u(),P(St,{class:"table-row-grid text-table-small",key:_.id,data:_},null,8,["data"]))),128)),(u(!0),c(I,null,E(l(x),_=>(u(),c("div",{key:s.data.id+"-"+_,class:"table-row-grid text-table-small grid gap-2 px-3 py-1.5"},bt))),128))],2))}});function Nt({competition:s,category:e,fetchEnabled:R}){const{key:S,getRelayTeamsLoader:k}=J();if(!k)throw new Error(`Relay loader not available for provider ${S}`);const{relayTeams:f,status:T}=k({category:e,competition:s,fetchEnabled:R}),p=d(()=>{if(T.value!=="success"||!f.value||f.value.length===0)return 0;const a=f.value.map(r=>r.athletes.length);return Math.max(...a)}),x=[t.NotStarted,t.Running,t.Ok,t.DidNotStart,t.OverMaxTime,t.Mispunch,t.Disqualified,t.DidNotFinish,t.NotCompeting],y=d(()=>T.value!=="success"||!f.value?[]:f.value.map(a=>{let n=0,r=0;const o=[...a.athletes].sort((i,h)=>i.leg-h.leg);o.length!==p.value&&(r=x.length-1);const m=o.map(i=>{const h=x.findIndex(A=>A===i.status);return h>r&&(r=h),i.status===t.Running||i.status===t.NotStarted?{...i,legResult:{status:i.status},totalResult:{status:i.status}}:(n+=i.timeSeconds,{...i,legResult:{timeSeconds:i.timeSeconds,status:i.status},totalResult:{timeSeconds:n,status:x[r]}})});return{...a,status:x[r],athletes:m}})),b=a=>a.length===0?[]:a.reduce((n,r)=>{for(const o of r.athletes)n[o.leg-1].push(o);return n},Array.from({length:p.value},()=>[])),_=(a,n)=>{const r=[];for(const o of a){const m=o[n];F(m)&&r.push(m.timeSeconds)}return r.sort((o,m)=>o-m)},C=a=>a.length===0?[]:a.reduce((n,r,o)=>(n[o].legTimes=_(r,"legResult"),n[o].totalTimes=_(r,"totalResult"),n),Array.from({length:a.length},()=>({legTimes:[],totalTimes:[]}))),$=d(()=>{if(y.value.length===0)return[];const a=C(b(y.value)),n=a.map(o=>o.legTimes[0]),r=a.map(o=>o.totalTimes[0]);return y.value.map(o=>{let m=0;const i=o.athletes.map((h,A)=>{m===A&&h.status!==t.NotStarted&&h.status!==t.Running&&m++;const w=h.leg-1,Y=F(h.legResult)?M(h.legResult,a[w].legTimes,n[w]):{...h.legResult},j=F(h.totalResult)?M(h.totalResult,a[w].totalTimes,r[w]):{...h.totalResult};return{...h,legResult:Y,totalResult:j}});return{...o,athletes:i,legsDone:m,status:m!==p.value&&o.status===t.Ok?t.Running:o.status,latestTotalResult:i.length?i[m>0?m-1:0].totalResult:{status:t.NotStarted},updatedAt:m>0?i[m-1].updatedAt:void 0}})}),M=(a,n,r)=>{const o=a.timeSeconds,m=n.indexOf(o),i=$t(r,o);return{...a,rank:m+1,loss:i}},D=d(()=>$.value.length===0?[]:[...$.value].sort((a,n)=>a.status!==n.status?V[a.status]-V[n.status]:a.legsDone!==n.legsDone?n.legsDone-a.legsDone:a.latestTotalResult.status===t.Ok&&n.latestTotalResult.status===t.Ok&&a.latestTotalResult.timeSeconds!==n.latestTotalResult.timeSeconds?a.latestTotalResult.timeSeconds-n.latestTotalResult.timeSeconds:a.name.localeCompare(n.name))),W=d(()=>{const a=D.value.filter(n=>n.status!==t.NotStarted&&n.status!==t.Running);return{full:D.value.length,finished:a.length,unfinished:D.value.length-a.length}});return{status:T,relayTeams:D,teamCounts:W,legCount:p}}const Ot=[t.Ok,t.Running,t.NotStarted,t.OverMaxTime,t.NotCompeting,t.DidNotStart,t.DidNotFinish,t.Mispunch,t.Disqualified],V=Ot.reduce((s,e,R)=>(s[e]=R,s),{});function $t(s,e){return e-s}const Dt={class:"w-full text-3xl font-bold bg-white"},wt={key:0,class:"bg-gray-300 h-100"},At=v("span",null,"Loading data",-1),Ft=[At],Bt=O({__name:"CategoryRelayTable",props:{competition:null,category:null},setup(s){const e=s,{scrollItemRef:R,stickyRef:S,contentRef:k,isActive:f}=at(e.category.name),{relayTeams:T,teamCounts:p,status:x,legCount:y}=Nt({competition:e.competition,category:e.category,fetchEnabled:f});return et(q,f),(b,_)=>(u(),c("div",{ref_key:"scrollItemRef",ref:R},[v("div",{class:"sticky top-0",ref_key:"stickyRef",ref:S},[L(H,{class:"p-3",category:e.category,"athletes-count":l(p)},null,8,["category","athletes-count"])],512),v("div",{ref_key:"contentRef",ref:k},[v("div",Dt,[(u(!0),c(I,null,E(l(T),(C,$)=>(u(),P(Ct,{key:C.id,"is-even":$%2===0,data:C,"leg-count":l(y)},null,8,["is-even","data","leg-count"]))),128))])],512),l(x)!=="success"?(u(),c("div",wt,Ft)):st("",!0)],512))}});export{Bt as default};
