import{m as ie,r as b,c as C,n as Q,d as U,o as _,a as B,b as n,t as Y,u as l,g as G,w as X,i as ge,p as fe,s as pe,q as be,x as ve,y as ye,z as he,e as _e,A as se,B as Ce,C as xe,l as q,h as ae,F as J,f as K,_ as le,j as E,D as j,E as we,G as Se,H as re,I as ke}from"./index-4a37b7ad.js";import{u as Ie,b as Te,c as Re,d as De,a as Be,_ as Ve}from"./useDataProvider-3479f118.js";const W=ie("settings",()=>{const f=b(!1);function t(s){typeof s>"u"?f.value=!f.value:f.value=s}const r=b("page"),o=b(1);function e(s){o.value=s,y()}const a=b(1),g=C(()=>a.value*1e3);function p(s){r.value=s}const x=b(!0),S=b([]),R=b([]),k=s=>{!s.length||JSON.stringify(s)===JSON.stringify(S.value)||(S.value=s,R.value=s.map(c))},w=C(()=>R.value.sort((s,m)=>s.order-m.order)),D=C(()=>w.value.filter(s=>s.selected)),V=b([]),M=s=>Array.from({length:s},()=>[]);Q([D,o],F,{immediate:!0});function F(){V.value=D.value.reduce((s,m)=>(s[m.column-1].push(m),s),M(o.value))}function c(s,m){return{name:s,selected:!0,column:1,order:m}}function i(s,m){const I=m??!s.selected;s.selected=I,o.value===1?s.column=I?1:null:y()}function d(s,m){s.selected&&(m>o.value||(s.column=m,F()))}function v(s,m){const I=s.order,A=m?I-1:I+1,O=w.value[A];O.order=I,s.order=A}function y(){const s=Ae(D.value,o.value);for(let m=0;m<s.length;m++)for(const I of s[m])I.column=m+1;F()}return{areSettingsDisplayed:f,setSettingsDisplayed:t,scrollType:r,setScrollType:p,scrollColumnsCount:o,setScrollColumnsCount:e,readLineTimeSeconds:a,readLineTimeMS:g,showUnfinishedAthletes:x,availableCategories:S,categoriesDisplayRaw:R,categoriesDisplay:w,categoriesDisplayByColumn:V,setAvailableCategories:k,setCategoryDisplayColumn:d,setCategoryDisplayOrder:v,setCategorySelected:i}},{persist:!0});function Ae(f,t){const r=[],o=[...f],e=Math.round(f.length/t);for(let a=t;a>1;a--)r.push(o.splice(0,e));return r.push(o),r}const Me={class:"tabular-nums"},Fe=n("span",null,null,-1),Le={class:"absolute right-3 z-2 bg-header"},Pe=U({__name:"CompetitionHeader",props:{competition:null},setup(f){const t=f,r=W(),{nowFormatted:o}=Ie(),e=b(!1);return(a,g)=>{const p=fe("RouterLink");return _(),B("h1",{class:"flex justify-between gap-2.5 bg-header font-mrb font-bold text-4xl text-white p-3",onMouseenter:g[1]||(g[1]=x=>e.value=!0),onMouseleave:g[2]||(g[2]=x=>e.value=!1)},[n("span",Me,Y(l(o)),1),n("span",null,Y(t.competition.name),1),Fe,n("div",Le,[G(p,{"data-testid":"home-button",to:"/"},{default:X(()=>[ge("Home")]),_:1}),n("button",{onClick:g[0]||(g[0]=()=>l(r).setSettingsDisplayed()),class:"ml-3 i-mdi-cog"})])],32)}}}),ue=Symbol();function $e(f){const t=b(null),r=C(()=>t.value?t.value.getBoundingClientRect():{top:0,height:100,bottom:100}),o=[];let e=[];const a=pe({}),g=C(()=>f.value==="none"||f.value==="continues"?250:1e3),p=Te(()=>{S()},100,{maxWait:g});Re(t,"scroll",p),be(ue,c=>{o.push(c),p()});function S(){e=[];for(const c of o){const i=R(c.elementRef.value);i!==c.isActive.value&&(c.isActive.value=i),i&&e.push(c)}V()}function R(c){const i=c.getBoundingClientRect();return i.top<r.value.bottom+r.value.height&&i.bottom>r.value.top}function k(c,{top:i=r.value.top,bottom:d=r.value.bottom}={}){const v=c.getBoundingClientRect();return Math.round(v.bottom)<=Math.round(d)&&Math.round(v.top)>=Math.round(i)}function w(c){const i=c.getBoundingClientRect();return i.top<r.value.bottom&&i.bottom>r.value.top}const D=c=>{var d;const i=c.contentRef.value;return i?((d=i.children[0])==null?void 0:d.children)??[]:[]};function V(){a.value={};let c=!0;for(const i of e){const d=w(i.elementRef.value),v={item:i,isFirstItem:c,isVisible:d};c=!1;const y=D(i);if(d&&y.length>0){const s=[],m=i.stickyRef.value,I=m==null?void 0:m.getBoundingClientRect().bottom;for(let A=0;A<y.length;A++){const O=y[A];k(O,{top:I})&&s.push(A)}v.subItemsVisible=s,v.subItemsLength=y.length}a.value[i.id]=v}}function M(){var c;for(const i of e){const d=a.value[i.id];if(!d)continue;const v=((c=d.subItemsVisible)==null?void 0:c.length)||0;if(!d.isFirstItem)return{item:i,isFirstItem:!1};if(v>=2){const y=D(i);return{item:i,currentSubItem:y[d.subItemsVisible[0]],nextSubItem:y[d.subItemsVisible[1]],isFirstItem:!0}}}return null}function F(){var c;for(const i of e){const d=a.value[i.id];if(!d)continue;if(!d.isVisible)return{item:i,isFirstItem:d.isFirstItem};const v=(c=d.subItemsVisible)==null?void 0:c.slice(-1)[0],y=v!==void 0;if(!y&&!d.isFirstItem)return{item:i,isFirstItem:d.isFirstItem};if(y&&v<d.subItemsLength-1)return{item:i,nextSubItem:D(i)[v+1],isFirstItem:d.isFirstItem}}return null}return{columnWrapper:t,columnWrapperRect:r,columnItems:o,getNextItemOnPage:M,getNextItemBelowPage:F,checkItemsVisibility:V}}function kt(f){const t=ve(ue);if(!t)throw new Error("registerScrollColumnItem not provided");const r=b(null),o=b(null),e=b(null),a=b(!1);return ye(()=>{r.value&&t({id:f,elementRef:b(r.value),stickyRef:o,contentRef:e,isActive:a})}),{scrollItemRef:r,stickyRef:o,contentRef:e,isActive:a}}const ce=ie("tableSizing",()=>{const f=b(50),t=b("single");return{lineHeight:C(()=>f.value*(t.value==="relay"?4:1)),mode:t}}),Ee=U({__name:"ScrollColumn",setup(f){const t=W(),r=ce(),o=b(null),{columnWrapper:e,columnWrapperRect:a,getNextItemOnPage:g,getNextItemBelowPage:p,checkItemsVisibility:x}=$e(he(t,"scrollType")),S=C(()=>a.value?Math.floor(a.value.height/r.lineHeight):0),R=C(()=>S.value*t.readLineTimeMS||1e3);let k=null,w={};const D={page:I,row:A,continues:O};Q(()=>t.scrollType,u=>{k&&(k(),k=null),u!=="none"&&(k=D[u]())},{immediate:!0});function V(){return o.value?c(o.value):!0}function M(){return o.value?a.value.top>=0:!0}function F(){var u;(u=e.value)==null||u.scrollTo({top:0,behavior:"smooth"})}function c(u){const T=l(u).getBoundingClientRect(),L=16,P=T.bottom-a.value.bottom;return Math.floor(P)<=L}function i(u){var T,L,P;const h=u();if(!h){x();return}if(h.nextSubItem){const z=h.nextSubItem.getBoundingClientRect(),H=((T=h.item.stickyRef.value)==null?void 0:T.offsetHeight)||0,N=z.top-a.value.top-H;(L=e.value)==null||L.scrollBy({top:N,behavior:"smooth"})}else{const H=h.item.elementRef.value.getBoundingClientRect().top-a.value.top;(P=e.value)==null||P.scrollBy({top:H,behavior:"smooth"})}}const y={page:()=>i(p),row:()=>i(g)};function s(u){M()&&x(),V()?F():u()}function m(u,h){const T=w[u]??De(()=>s(y[u]),h);return w[u]||(w[u]=T),T.isActive.value||T.resume(),T.pause}function I(){return m("page",R)}function A(){return m("row",()=>t.readLineTimeMS)}function O(){const u=b(!1),h=()=>u.value=!0;return Z(u),h}function Z(u){window.setTimeout(()=>{u.value||de(u)},R.value/2)}function de(u){if(e.value===null||o.value===null)return;const h=e.value.getBoundingClientRect(),T=o.value.getBoundingClientRect(),L=T.bottom-(h.height+h.top),P=Math.floor(L/r.lineHeight)*t.readLineTimeMS,z=h.top-T.top,H=L;let N=null,$;const ee=function(te){var ne;if(u.value){$&&window.cancelAnimationFrame($);return}N||(N=te);const oe=te-N,me=Math.min(oe/P,1);(ne=e.value)==null||ne.scrollTo(0,z+H*me),oe<P?$=window.requestAnimationFrame(ee):$&&(window.cancelAnimationFrame($),window.setTimeout(()=>{u.value||(F(),Z(u))},R.value))};$=window.requestAnimationFrame(ee)}return(u,h)=>(_(),B("div",{class:"flex-1 overflow-y-scroll columnWrapper",ref_key:"columnWrapper",ref:e},[n("div",{ref_key:"columnContent",ref:o},[_e(u.$slots,"default")],512)],512))}});function Oe(f){const{getCompetitionLoader:t}=Be(),{competition:r,status:o}=t(f),e=ce(),a=C(()=>r.value?[...r.value.categories].sort((x,S)=>x.name.localeCompare(S.name)):[]),g=C(()=>{if(r.value)return{...r.value,categories:a.value}});return Q(()=>{var p;return(p=r.value)==null?void 0:p.isRelay},(p,x)=>{!p||p===x||(e.mode=p?"relay":"single")},{immediate:!0}),{competition:g,status:o}}const He={class:"font-mrb grow flex overflow-hidden pt-3"},Ne={key:1},Ue={key:2},We=U({__name:"CompetitionTable",props:{competitionId:null},setup(f){const t=f,r=se(()=>le(()=>import("./CategoryTable-c3c70ea7.js"),["assets/CategoryTable-c3c70ea7.js","assets/dateTime-aa0fff04.js","assets/useDataProvider-3479f118.js","assets/index-4a37b7ad.js","assets/index-8909426f.css","assets/CategoryTable-6d55fd53.css"])),o=se(()=>le(()=>import("./CategoryRelayTable-662f9669.js"),["assets/CategoryRelayTable-662f9669.js","assets/dateTime-aa0fff04.js","assets/useDataProvider-3479f118.js","assets/index-4a37b7ad.js","assets/index-8909426f.css","assets/CategoryRelayTable-47d3e90d.css"])),e=W(),{competitionId:a}=Ce(t),{competition:g,status:p}=Oe(a),x=C(()=>g.value?g.value.isRelay?o:r:null),S=C(()=>g.value?g.value.categories.reduce((k,w)=>(k[w.name]=w,k),{}):{}),R=C(()=>Object.keys(S.value));return xe(()=>e.setAvailableCategories(R.value)),(k,w)=>(_(),B(J,null,[l(g)?(_(),q(Pe,{key:0,competition:l(g)},null,8,["competition"])):ae("",!0),n("div",He,[l(p)==="success"&&l(g)?(_(!0),B(J,{key:0},K(l(e).categoriesDisplayByColumn,(D,V)=>(_(),q(Ee,{key:"result-col-"+V,class:"px-1.5"},{default:X(()=>[(_(!0),B(J,null,K(D,M=>(_(),q(l(x),{key:M.name,competition:l(g),category:l(S)[M.name],class:"mb-4"},null,8,["competition","category"]))),128))]),_:2},1024))),128)):l(p)==="loading"?(_(),B("div",Ne,"Loading data")):(_(),B("div",Ue,"Error occured while loading data, try again later"))])],64))}}),ze={class:"overflow-auto shadow-lg border-t-4 bg-white mb-4 rounded-l-lg rounded-t border-header w-full md:w-1/4"},je={class:"px-6 py-4 mt-4 mb-8"},qe=n("h3",null,"Result table settings",-1),Je={class:"mb-6"},Ye=n("h4",null,"Column number",-1),Ge={class:"flex flex-col items-start mb-2"},Ke=n("label",{for:"scroll-columns-count",class:"hidden block mb-1 mr-2 text-sm font-medium text-gray-900 dark:text-white"},"Column number",-1),Qe=["value"],Xe=n("h4",null,"(Auto) Scrolling",-1),Ze={class:"flex items-center mb-2"},et=n("label",{for:"scroll-page",class:"ml-2 text-sm font-medium text-gray-900 dark:text-gray-300"},"Scroll by page",-1),tt={class:"flex items-center mb-2"},ot=n("label",{for:"scroll-row",class:"ml-2 text-sm font-medium text-gray-900 dark:text-gray-300"},"Scroll by row",-1),nt={class:"flex items-center mb-2"},st=n("label",{for:"scroll-continues",class:"ml-2 text-sm font-medium text-gray-900 dark:text-gray-300"},"Continues scroll",-1),lt={class:"flex items-center mb-2"},rt=n("label",{for:"scroll-none",class:"ml-2 text-sm font-medium text-gray-900 dark:text-gray-300"},"Manual scroll",-1),it=n("h4",null,"Scroll speed (time per result line)",-1),at={class:"flex items-center mb-2"},ut={for:"scroll-speed",class:"block mb-1 mr-2 text-sm font-medium text-gray-900 dark:text-white"},ct=n("h4",null,"Table content",-1),dt={class:"flex items-center mb-2"},mt=n("label",{for:"unfinished-checkbox",class:"ml-2 text-sm font-medium text-gray-900 dark:text-gray-300"},"Show unfinished (startlist, running)",-1),gt=n("h5",null,"Displayed classes",-1),ft={class:"flex flex-col flex-wrap gap-y-2"},pt=["for"],bt=["id","checked","onChange"],vt=["value","onInput","max"],yt=["disabled","onClick"],ht=["disabled","onClick"],_t=U({__name:"CompetitionSettings",setup(f){const t=W();return(r,o)=>(_(),B("div",ze,[n("div",je,[qe,n("form",null,[n("div",Je,[Ye,n("div",Ge,[Ke,n("input",{value:l(t).scrollColumnsCount,onInput:o[0]||(o[0]=e=>l(t).setScrollColumnsCount(parseInt(e.target.value))),id:"scroll-columns-count",type:"number",min:"1",max:"10",step:"1",class:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5"},null,40,Qe)]),Xe,n("div",Ze,[E(n("input",{"onUpdate:modelValue":o[1]||(o[1]=e=>l(t).scrollType=e),id:"scroll-page",type:"radio",value:"page",name:"scroll by page",class:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600"},null,512),[[j,l(t).scrollType]]),et]),n("div",tt,[E(n("input",{"onUpdate:modelValue":o[2]||(o[2]=e=>l(t).scrollType=e),id:"scroll-row",type:"radio",value:"row",name:"scroll by row",class:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600"},null,512),[[j,l(t).scrollType]]),ot]),n("div",nt,[E(n("input",{"onUpdate:modelValue":o[3]||(o[3]=e=>l(t).scrollType=e),id:"scroll-continues",type:"radio",value:"continues",name:"scroll continuesly",class:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600"},null,512),[[j,l(t).scrollType]]),st]),n("div",lt,[E(n("input",{"onUpdate:modelValue":o[4]||(o[4]=e=>l(t).scrollType=e),id:"scroll-none",type:"radio",value:"none",name:"scroll manually",class:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600"},null,512),[[j,l(t).scrollType]]),rt]),it,n("div",at,[n("label",ut,Y(l(t).readLineTimeSeconds)+"s",1),E(n("input",{"onUpdate:modelValue":o[5]||(o[5]=e=>l(t).readLineTimeSeconds=e),id:"scroll-speed",type:"range",min:"0.1",max:"4",step:"0.1",class:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer dark:bg-gray-700"},null,512),[[we,l(t).readLineTimeSeconds]])]),ct,n("div",dt,[E(n("input",{id:"unfinished-checkbox",type:"checkbox","onUpdate:modelValue":o[6]||(o[6]=e=>l(t).showUnfinishedAthletes=e),class:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600"},null,512),[[Se,l(t).showUnfinishedAthletes]]),mt]),gt,n("div",ft,[(_(!0),B(J,null,K(l(t).categoriesDisplay,e=>(_(),B("div",{key:e.name,class:"grid grid-cols-5 gap-2"},[n("label",{for:`show-category-${e.name}`,class:"ml-2 text-sm font-medium text-gray-900 dark:text-gray-300"},Y(e.name),9,pt),n("input",{id:`show-category-${e.name}`,type:"checkbox",checked:e.selected,onChange:()=>l(t).setCategorySelected(e),class:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600"},null,40,bt),n("input",{value:e.column,onInput:a=>l(t).setCategoryDisplayColumn(e,parseInt(a.target.value)),type:"number",min:"1",max:l(t).scrollColumnsCount,step:"1",class:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-1"},null,40,vt),n("button",{disabled:e.order===0,onClick:re(()=>l(t).setCategoryDisplayOrder(e,!0),["prevent"])}," Up ",8,yt),n("button",{disabled:e.order===l(t).categoriesDisplay.length-1,onClick:re(()=>l(t).setCategoryDisplayOrder(e,!1),["prevent"])}," Down ",8,ht)]))),128))])])])])]))}}),Ct={class:"w-screen h-screen overflow-hidden flex flex-col"},xt=U({__name:"CompetitionView",setup(f){const t=ke(),r=C(()=>t.params.competitionId??"1"),o=C(()=>t.params.providerId),e=W();return(a,g)=>(_(),B("div",Ct,[G(Ve,{provider:l(o)},{default:X(()=>[G(We,{"competition-id":l(r)},null,8,["competition-id"])]),_:1},8,["provider"]),l(e).areSettingsDisplayed?(_(),q(_t,{key:0,class:"fixed inset-y-24 right-0 z-3"})):ae("",!0)]))}}),It=Object.freeze(Object.defineProperty({__proto__:null,default:xt},Symbol.toStringTag,{value:"Module"}));export{It as C,kt as a,W as u};
