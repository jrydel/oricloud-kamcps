import{d as T,f as _,_ as E}from"./dateTime-e20df54b.js";import{u as x,A as h,a as B}from"./useDataProvider-03a214e4.js";import{d as R,c as m,o as a,a as r,u as s,t as u,b as g,a4 as F,g as O,l as w,h as v,F as A,f as S}from"./index-64045075.js";import{u as U,a as D}from"./CompetitionView-e5b3497d.js";const I={key:0,class:"tabular-nums"},V={key:1},L={key:2},z={key:3,class:"text-right tabular-nums"},H={key:4,class:"text-right"},M={key:5,class:"text-right tabular-nums"},P={key:6},C=R({__name:"CategoryTableFinishedRow",props:{data:null,isEven:{type:Boolean}},setup(t){const e=t,{now:n}=x(),l=5*60,c=m(()=>e.data.updatedAt?T(n.value,e.data.updatedAt)<l:!1),d=m(()=>c.value?"bg-highlight":e.isEven?"bg-even":"bg-white"),o=m(()=>c.value?"text-white":"text-black");return(f,i)=>(a(),r("div",{class:F([[s(d),s(o)],"grid table-row-grid gap-2 px-3 py-1.5 rounded-lg"])},[t.data.status===s(h).Ok?(a(),r("span",I,u(t.data.rank)+".",1)):t.data.status===s(h).NotCompeting?(a(),r("span",V,"NC")):(a(),r("span",L)),g("span",null,u(t.data.surname)+" "+u(t.data.firstName),1),g("span",null,u(t.data.card),1),g("span",null,u(t.data.club),1),t.data.status===s(h).Ok||t.data.status===s(h).NotCompeting?(a(),r("span",z,u(t.data.time),1)):(a(),r("span",H,u(s(h)[t.data.status]),1)),t.data.loss?(a(),r("span",M,"+ "+u(t.data.loss),1)):(a(),r("span",P))],2))}});const Y=g("span",null,null,-1),j={key:0,class:"text-right tabular-nums"},q={key:1,class:"text-right tabular-nums"},G={key:2},J=g("span",null,null,-1),K=R({__name:"CategoryTableUnfinishedRow",props:{data:null,isEven:{type:Boolean},isVisible:{type:Boolean}},setup(t){const e=t,n=e.isEven?"bg-even":"bg-white",{now:l,timeFormatter:c}=x(),d=m(()=>e.data.startTime?e.data.startTime<l.value:e.data.status===h.Running),o=m(()=>c.format(e.data.startTime)),f=m(()=>{if(!e.data.startTime||!d.value||!e.isVisible)return"";const i=T(l.value,e.data.startTime);return _(i)});return(i,y)=>(a(),r("div",{class:F([s(n),"grid table-row-grid gap-2 px-3 py-1.5 rounded-lg"])},[Y,g("span",null,u(t.data.surname)+" "+u(t.data.firstName),1),g("span",null,u(t.data.card),1),g("span",null,u(t.data.club),1),s(d)?(a(),r("span",j,"( "+u(s(f))+" )",1)):s(d)?(a(),r("span",G)):(a(),r("span",q,u(s(o)),1)),J],2))}});function Q({competition:t,category:e,fetchEnabled:n}){const{getAthletesLoader:l}=B(),{rawAthletes:c,status:d}=l({category:e,competition:t,fetchEnabled:n}),o=m(()=>d.value!=="success"||!c.value?{finished:[],unfinished:[]}:c.value.reduce((i,y)=>(y.status===h.NotStarted||y.status===h.Running?i.unfinished.push(y):i.finished.push(y),i),{finished:[],unfinished:[]})),f=m(()=>o.value.finished.length>0||o.value.unfinished.length>0);return{status:d,athletes:o,areAvailable:f}}function W(t){return m(()=>{if(!t.value.finished.length)return{firstRow:null,restRows:[]};const n=[...t.value.finished];return n.sort(X),Z(n)})}function X(t,e){return t.status!==e.status?t.status-e.status:t.timeSeconds!==e.timeSeconds?t.timeSeconds-e.timeSeconds:0}function Z(t){const e=t[0];if(e.status!==h.Ok)return{firstRow:null,restRows:t};const n={...e,rank:1,time:_(e.timeSeconds),loss:""};let l=n.time,c=n.rank;const d=t.slice(1).map((o,f)=>{if(o.status===h.Ok){const i=_(o.timeSeconds);return l===i||(c=f+2,l=i),{...o,rank:c,time:i,loss:tt(n,o)}}if(o.status===h.NotCompeting){const i=_(o.timeSeconds);return{...o,time:i}}return o});return{firstRow:n,restRows:d}}function tt(t,e){const n=e.timeSeconds-t.timeSeconds;return n===0?"":_(n)}function et(t){return m(()=>{if(!t.value.unfinished.length)return[];const n=[...t.value.unfinished];return n.sort(st),n})}function st(t,e){return t.startTime&&e.startTime?t.startTime>e.startTime?1:-1:t.status!==e.status?t.status-e.status:t.surname<e.surname?-1:1}const nt={key:0,class:"w-full text-3xl font-bold bg-white"},at={key:0,class:"w-full text-3xl font-bold bg-white"},it={key:0,class:"bg-gray-300 h-100"},ot=g("span",null,"Loading data",-1),rt=[ot],mt=R({__name:"CategoryTable",props:{competition:null,category:null},setup(t){const e=t,n=U(),{scrollItemRef:l,stickyRef:c,contentRef:d,isActive:o}=D(e.category.name),{status:f,athletes:i,areAvailable:y}=Q({competition:e.competition,category:e.category,fetchEnabled:o}),$=m(()=>({finished:i.value.finished.length,unfinished:i.value.unfinished.length,full:i.value.finished.length+i.value.unfinished.length})),b=W(i),N=et(i);return(ut,lt)=>(a(),r("div",{ref_key:"scrollItemRef",ref:l},[g("div",{class:"sticky top-0",ref_key:"stickyRef",ref:c},[O(E,{class:"p-3",category:e.category,"athletes-count":s($)},null,8,["category","athletes-count"]),s(f)==="success"&&s(y)?(a(),r("div",nt,[s(b).firstRow?(a(),w(C,{key:0,data:s(b).firstRow,"is-even":!1,class:"border-b-2 border-gray-600 border-dashed"},null,8,["data"])):v("",!0)])):v("",!0)],512),g("div",{ref_key:"contentRef",ref:d},[s(f)==="success"&&s(y)?(a(),r("div",at,[(a(!0),r(A,null,S(s(b).restRows,(p,k)=>(a(),w(C,{data:p,key:p.rank,"is-even":k%2===0},null,8,["data","is-even"]))),128)),s(n).showUnfinishedAthletes?(a(!0),r(A,{key:0},S(s(N),(p,k)=>(a(),w(K,{data:p,key:k,"is-even":k%2===0,"is-visible":s(o),class:"border-t-2 border-gray-600 border-dashed"},null,8,["data","is-even","is-visible"]))),128)):v("",!0)])):v("",!0)],512),s(f)==="success"&&s(y)?v("",!0):(a(),r("div",it,rt))],512))}});export{mt as default};
